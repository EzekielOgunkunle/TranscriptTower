{% extends 'base.html' %}
{% block title %}My Transcript Requests{% endblock %}
{% block content %}
<h2>My Transcript Requests</h2>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Status</th>
      <th>Price</th>
      <th>Payment</th>
      <th>Admin Feedback</th>
      <th>Download</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for req in requests %}
    <tr>
      <td>{{ req.id }}</td>
      <td>{{ req.get_request_type_display }}</td>
      <td>{{ req.get_status_display }}</td>
      <td>{% if req.price %}â‚¦{{ req.price }}{% else %}-{% endif %}</td>
      <td>{% if req.payment_confirmed %}Confirmed{% elif req.status == 'ready_for_payment' %}Pending{% else %}-{% endif %}</td>
      <td>{{ req.admin_feedback|default:"-" }}</td>
      <td>
        {% if req.pdf_file %}
          <a href="{% url 'transcripts:download' req.id %}" class="btn btn-sm btn-success">Download PDF</a>
        {% else %}-{% endif %}
      </td>
      <td>
        {% if req.status == 'ready_for_payment' and not req.payment_confirmed %}
          {% if req.price %}
            <a href="{% url 'transcripts:paystack_payment' req.id %}" class="btn btn-sm btn-primary mb-1">Pay with Paystack</a>
            <form method="post" action="" style="display:inline;">
              {% csrf_token %}
              <button type="button" class="btn btn-sm btn-warning" onclick="alert('Please follow the manual payment instructions sent to your email or contact admin.')">Manual Payment</button>
            </form>
          {% else %}
            <span class="text-danger">Awaiting admin to set price</span>
          {% endif %}
        {% elif req.status == 'pending' %}
          <span class="text-muted">Awaiting admin review</span>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="8">No requests yet.</td></tr>
    {% endfor %}
  </tbody>
</table>
<a href="{% url 'transcripts:request_create' %}" class="btn btn-primary">New Request</a>
{% endblock %}
